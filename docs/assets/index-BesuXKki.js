import{r as u,a as Q,R as V}from"./react-nf7bT_Uh.js";import{i as F,s as k,a as Z,l as ee,m as te,c as se,b as re,d as le,z as ae}from"./d3-BqCrgHhh.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))l(n);new MutationObserver(n=>{for(const c of n)if(c.type==="childList")for(const m of c.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&l(m)}).observe(document,{childList:!0,subtree:!0});function i(n){const c={};return n.integrity&&(c.integrity=n.integrity),n.referrerPolicy&&(c.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?c.credentials="include":n.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function l(n){if(n.ep)return;n.ep=!0;const c=i(n);fetch(n.href,c)}})();var H={exports:{}},L={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ne=u,ce=Symbol.for("react.element"),ie=Symbol.for("react.fragment"),oe=Object.prototype.hasOwnProperty,de=ne.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,ue={key:!0,ref:!0,__self:!0,__source:!0};function Y(a,s,i){var l,n={},c=null,m=null;i!==void 0&&(c=""+i),s.key!==void 0&&(c=""+s.key),s.ref!==void 0&&(m=s.ref);for(l in s)oe.call(s,l)&&!ue.hasOwnProperty(l)&&(n[l]=s[l]);if(a&&a.defaultProps)for(l in s=a.defaultProps,s)n[l]===void 0&&(n[l]=s[l]);return{$$typeof:ce,type:a,key:c,ref:m,props:n,_owner:de.current}}L.Fragment=ie;L.jsx=Y;L.jsxs=Y;H.exports=L;var e=H.exports,U={},M=Q;U.createRoot=M.createRoot,U.hydrateRoot=M.hydrateRoot;const fe=({selectedSection:a,onSectionChange:s})=>{const i=[{value:"sec0-2",label:"0-2 自分の道を見つける"},{value:"sec1-0",label:"1-0 多元性を見る"},{value:"sec2-0",label:"2-0 ITと民主主義 拡大する溝"},{value:"sec2-1",label:"2-1 玉山からの眺め"},{value:"sec2-2",label:"2-2 デジタル民主主義の日常"},{value:"sec3-0",label:"3-0 プルラリティ（多元性）とは？"},{value:"sec3-1",label:"3-1 ⿻世界に生きる"},{value:"sec3-2",label:"3-2 つながった社会"},{value:"sec3-3",label:"3-3 失われた道"},{value:"sec4-0",label:"4-0 権利、オペレーティングシステム、的自由"},{value:"sec4-1",label:"4-1 IDと人物性"},{value:"sec4-2",label:"4-2 団体と公衆"},{value:"sec4-3",label:"4-3 商取引と信頼"},{value:"sec4-4",label:"4-4 財産と契約"},{value:"sec4-5",label:"4-5 アクセス"},{value:"sec5-0",label:"5-0 協働テクノロジーと民主主義"},{value:"sec5-1",label:"5-1 ポスト表象コミュニケーション"},{value:"sec5-2",label:"5-2 没入型共有現実（ISR）"},{value:"sec5-3",label:"5-3 クリエイティブなコラボレーション"},{value:"sec5-4",label:"5-4 拡張熟議"},{value:"sec5-5",label:"5-5 適応型管理行政"},{value:"sec5-6",label:"5-6 ⿻投票"},{value:"sec5-7",label:"5-7 社会市場"},{value:"sec6-0",label:"6-0  から現実へ"},{value:"sec6-1",label:"6-1 職場"},{value:"sec6-2",label:"6-2 保健"},{value:"sec6-3",label:"6-3 メディア"},{value:"sec6-4",label:"6-4 環境"},{value:"sec6-5",label:"6-5 学習"},{value:"sec7-0",label:"7-0 政策"},{value:"sec7-1",label:"7-1 結論"}];return e.jsxs("div",{id:"toolbar",children:[e.jsx("h1",{children:"Plurality本の概念マップ"}),e.jsxs("div",{className:"section-selector",children:[e.jsx("label",{htmlFor:"section-select",children:"セクション選択:"}),e.jsx("select",{id:"section-select",value:a,onChange:l=>s(l.target.value),children:i.map(l=>e.jsx("option",{value:l.value,children:l.label},l.value))})]})]})},he=({concept:a,edge:s,data:i,onConceptSelect:l,onEdgeSelect:n})=>{if(!a&&!s)return e.jsxs("div",{id:"details",children:[e.jsx("div",{className:"section-title",children:"概念または関係を選択してください"}),e.jsx("p",{style:{color:"var(--text-secondary)",fontSize:"13px"},children:"グラフ内のノードまたはエッジラベルをクリックすると、詳細情報と証拠が表示されます。"})]});if(s)try{return e.jsx("div",{id:"details",children:e.jsxs("div",{className:"concept-card",children:[e.jsxs("div",{className:"concept-header",children:[e.jsx("span",{className:"concept-tier tier-edge",children:"関係"}),e.jsx("h2",{className:"concept-title",children:s.relation_description||s.relation||s.type||"関係"})]}),i&&e.jsxs("div",{className:"related-concepts-section",children:[e.jsx("div",{className:"section-title",children:"関連概念"}),e.jsxs("div",{className:"related-concepts",children:[(()=>{var v;const r=typeof s.source=="string"?s.source:(v=s.source)==null?void 0:v.id,d=i.nodes.find(g=>g.id===r);return d?e.jsxs("div",{className:"related-concept clickable",onClick:()=>l&&l(d),children:[e.jsx("div",{className:"concept-name",children:d.label}),e.jsx("div",{className:"concept-def",children:d.definition})]}):null})(),(()=>{var v;const r=typeof s.target=="string"?s.target:(v=s.target)==null?void 0:v.id,d=i.nodes.find(g=>g.id===r);return d?e.jsxs("div",{className:"related-concept clickable",onClick:()=>l&&l(d),children:[e.jsx("div",{className:"concept-name",children:d.label}),e.jsx("div",{className:"concept-def",children:d.definition})]}):null})()]})]}),s.evidence&&s.evidence.length>0&&e.jsxs("div",{className:"evidence-section",children:[e.jsx("div",{className:"section-title",children:"根拠・引用"}),s.evidence.map((r,d)=>e.jsx("div",{className:"evidence-item",children:(r==null?void 0:r.text)||"証拠なし"},d))]})]})})}catch(r){return console.error("Error rendering edge details:",r),e.jsxs("div",{id:"details",children:[e.jsx("div",{className:"section-title",children:"エラー"}),e.jsx("p",{children:"関係情報の表示中にエラーが発生しました。"})]})}const c=a.aliases&&a.aliases.length>0?a.aliases:[],m=a.evidence&&a.evidence.length>0?a.evidence:[];return e.jsx("div",{id:"details",children:e.jsxs("div",{className:"concept-card",children:[e.jsxs("div",{className:"concept-header",children:[e.jsx("span",{className:"concept-tier tier-concept",children:"概念"}),e.jsx("h2",{className:"concept-title",children:a.label})]}),e.jsx("div",{className:"concept-definition",children:a.definition||"定義なし"}),c.length>0&&e.jsxs("div",{className:"aliases-section",children:[e.jsx("div",{className:"section-title",children:"別名・関連用語"}),e.jsx("div",{className:"aliases",children:c.map((r,d)=>e.jsx("span",{className:"alias-tag",children:r},d))})]}),m.length>0&&e.jsxs("div",{className:"evidence-section",children:[e.jsx("div",{className:"section-title",children:"根拠・引用"}),m.map((r,d)=>e.jsx("div",{className:"evidence-item",children:r.text},d))]}),i&&e.jsxs("div",{className:"relations-section",children:[e.jsx("div",{className:"section-title",children:"関係"}),e.jsx("div",{className:"relations",children:i.edges.filter(r=>{var g,y;const d=typeof r.source=="string"?r.source:(g=r.source)==null?void 0:g.id,v=typeof r.target=="string"?r.target:(y=r.target)==null?void 0:y.id;return d===a.id||v===a.id}).map((r,d)=>{var C,w;const v=typeof r.source=="string"?r.source:(C=r.source)==null?void 0:C.id,g=typeof r.target=="string"?r.target:(w=r.target)==null?void 0:w.id,S=v===a.id?g:v,b=i.nodes.find(I=>I.id===S),N=r.relation_description||(b?`${a.label}は${b.label}を${r.relation||r.type}。`:`${a.label}は${S}を${r.relation||r.type}。`);return e.jsx("div",{className:"relation-item clickable",onClick:()=>n&&n(r),children:e.jsx("div",{className:"relation-description",children:N})},d)})})]})]})})},pe=({data:a,onNodeSelect:s,onEdgeSelect:i,selectedConcept:l,selectedEdge:n})=>{const c=u.useRef(null),m=u.useRef(null),[r,d]=u.useState(!1),v=u.useRef(null),g=u.useRef(!1),y=u.useRef(null),S=u.useRef(F),b=u.useRef(s),N=u.useRef(i);u.useEffect(()=>{b.current=s,N.current=i},[s,i]);const C=u.useCallback(p=>{b.current(p)},[]),w=u.useCallback(p=>{N.current(p)},[]),I=u.useMemo(()=>{const p=a.nodes.map(j=>({...j})),R=new Map(p.map(j=>[j.id,j])),_=a.edges.map(j=>({...j,source:R.get(j.source),target:R.get(j.target)}));return{nodes:p,links:_,id2node:R}},[a]),D=u.useCallback(()=>{if(!c.current)return;const p=k(c.current),R=p.selectAll(".node"),_=p.selectAll(".link"),j=p.selectAll(".edge-label");if(R.classed("highlighted",!1).classed("dimmed",!1),_.classed("highlighted",!1).classed("dimmed",!1),j.classed("highlighted",!1).classed("dimmed",!1),l)R.classed("highlighted",h=>h.id===l.id).classed("dimmed",h=>h.id!==l.id);else if(n){const h=typeof n.source=="string"?n.source:n.source.id,x=typeof n.target=="string"?n.target:n.target.id;R.classed("highlighted",o=>o.id===h||o.id===x).classed("dimmed",o=>o.id!==h&&o.id!==x),_.classed("highlighted",o=>o.source.id===h&&o.target.id===x||o.source.id===x&&o.target.id===h).classed("dimmed",o=>!(o.source.id===h&&o.target.id===x||o.source.id===x&&o.target.id===h)),j.classed("highlighted",o=>o.source.id===h&&o.target.id===x||o.source.id===x&&o.target.id===h).classed("dimmed",o=>!(o.source.id===h&&o.target.id===x||o.source.id===x&&o.target.id===h))}},[l,n,a]);return u.useEffect(()=>{var G;if(!c.current||!m.current)return;const R=(G=k(m.current).node())==null?void 0:G.getBoundingClientRect();if(!R)return;const _=R.width,j=R.height;k(c.current).selectAll("*").remove();const h=k(c.current).attr("width",_).attr("height",j),x=h.append("g"),o=x.append("g"),J=x.append("g"),K=x.append("g"),{nodes:O,links:z}=I,W=o.selectAll("line").data(z).enter().append("line").attr("class","link"),X=J.selectAll("text").data(z).enter().append("text").attr("class","edge-label").text(t=>t.relation||t.type).style("cursor","pointer").on("click",function(t,f){t.stopPropagation(),g.current=!0,d(!0),w(f)}),$=K.selectAll("g").data(O).enter().append("g").attr("class",t=>`node ${t.tier||"core"}`);$.append("circle").attr("r",t=>t.tier==="core"||!t.tier?12:t.tier==="supplementary"?10:8),$.append("text").attr("dx",16).attr("dy",4).text(t=>t.label);const E=k("body").append("div").attr("class","tooltip").style("display","none"),B=function(t,f){$.classed("selected",!1),v.current=f,k(this).classed("selected",!0),C(f),t&&(g.current=!0,d(!0))};$.on("click",B).on("mouseover",(t,f)=>{v.current!==f&&E.style("display","block").html(`<strong>${f.label}</strong><br/>${f.definition||""}<br/><em>${f.tier||"core"}</em>`)}).on("mousemove",t=>{E.style("left",t.pageX+10+"px").style("top",t.pageY+10+"px")}).on("mouseout",()=>E.style("display","none"));const A=Z(O).force("link",ee(z).id(t=>t.id).distance(100).strength(.5)).force("charge",te().strength(-300)).force("center",se(_/2,j/2)).force("collision",re().radius(30));A.on("tick",()=>{W.attr("x1",t=>t.source.x).attr("y1",t=>t.source.y).attr("x2",t=>t.target.x).attr("y2",t=>t.target.y),X.attr("x",t=>(t.source.x+t.target.x)/2).attr("y",t=>(t.source.y+t.target.y)/2-5),$.attr("transform",t=>`translate(${t.x},${t.y})`)}),$.call(le().on("start",(t,f)=>{t.active||A.alphaTarget(.3).restart(),f.fx=f.x,f.fy=f.y}).on("drag",(t,f)=>{f.fx=t.x,f.fy=t.y}).on("end",(t,f)=>{t.active||A.alphaTarget(0),f.fx=null,f.fy=null}));const P=ae().scaleExtent([.3,3]).on("zoom",t=>{x.attr("transform",t.transform),S.current=t.transform});y.current=P,h.call(P),S.current&&!S.current.toString().includes("1,0,0,1,0,0")&&h.call(P.transform,S.current);const T=O.find(t=>t.tier==="core"||!t.tier);return T&&!g.current&&setTimeout(()=>{const t=$.filter(f=>f===T);t.empty()||B.call(t.node(),null,T)},100),D(),()=>{E.remove()}},[I,D]),u.useEffect(()=>{D()},[D]),e.jsxs("div",{ref:m,id:"graph-container",children:[e.jsx("svg",{ref:c,id:"graph"}),e.jsxs("div",{className:"zoom-controls",children:[e.jsx("div",{className:"zoom-btn",onClick:()=>{const p=k(c.current);y.current&&p.transition().call(y.current.scaleBy,1.5)},children:"+"}),e.jsx("div",{className:"zoom-btn",onClick:()=>{const p=k(c.current);y.current&&p.transition().call(y.current.scaleBy,.67)},children:"−"}),e.jsx("div",{className:"zoom-btn",style:{fontSize:"12px"},onClick:()=>{const p=k(c.current);y.current&&p.transition().call(y.current.transform,F)},children:"⌂"})]})]})},me={nodes:[{id:"loading",label:"データ読み込み中...",tier:"core",definition:"グラフデータが読み込まれるまでお待ちください",aliases:[],evidence:[]}],edges:[]},q=async a=>{const s=a?`graph_${a}.json`:"graph_sec1-0.json";try{const i=await fetch(`./${s}`);if(i.ok){const l=await i.json();return console.log(`Loaded ${s} successfully`),l}}catch{console.warn(`No ${s} found`)}if(a&&a!=="sec1-0")try{const i=await fetch("./graph_sec1-0.json");if(i.ok){const l=await i.json();return console.log("Loaded fallback graph_sec1-0.json successfully"),l}}catch{console.warn("No graph_sec1-0.json found either")}return console.log("Using fallback data - no graph files found"),me};function ve(){const[a,s]=u.useState({nodes:[],edges:[]}),[i,l]=u.useState(!0),[n,c]=u.useState(null),[m,r]=u.useState(null),[d,v]=u.useState("sec1-0"),g=b=>{c(b),r(null)},y=b=>{r(b),c(null)},S=async b=>{l(!0),c(null),r(null),v(b);try{const N=await q(b);s(N)}catch(N){console.warn("Error loading section data:",N)}finally{l(!1)}};return u.useEffect(()=>{(async()=>{try{const N=await q("sec1-0");N.nodes.length>0&&s(N)}catch(N){console.warn("Using sample data due to error:",N)}finally{l(!1)}})()},[]),i?e.jsx("div",{id:"app",style:{alignItems:"center",justifyContent:"center"},children:e.jsx("div",{children:"Loading concept map..."})}):e.jsxs("div",{id:"app",children:[e.jsxs("div",{id:"sidebar",children:[e.jsx(fe,{selectedSection:d,onSectionChange:S}),e.jsx(he,{concept:n,edge:m,data:a,onConceptSelect:g,onEdgeSelect:y})]}),e.jsx(pe,{data:a,onNodeSelect:g,onEdgeSelect:y,selectedConcept:n,selectedEdge:m})]})}U.createRoot(document.getElementById("root")).render(e.jsx(V.StrictMode,{children:e.jsx(ve,{})}));
