import{r as m,a as Y,R as J}from"./react-nf7bT_Uh.js";import{i as A,s as $,z as K,a as W,l as X,m as H,c as Q,b as V,d as ee}from"./d3-BqCrgHhh.js";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))l(n);new MutationObserver(n=>{for(const a of n)if(a.type==="childList")for(const v of a.addedNodes)v.tagName==="LINK"&&v.rel==="modulepreload"&&l(v)}).observe(document,{childList:!0,subtree:!0});function o(n){const a={};return n.integrity&&(a.integrity=n.integrity),n.referrerPolicy&&(a.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?a.credentials="include":n.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function l(n){if(n.ep)return;n.ep=!0;const a=o(n);fetch(n.href,a)}})();var F={exports:{}},O={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var te=m,se=Symbol.for("react.element"),re=Symbol.for("react.fragment"),le=Object.prototype.hasOwnProperty,ne=te.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,ae={key:!0,ref:!0,__self:!0,__source:!0};function G(c,r,o){var l,n={},a=null,v=null;o!==void 0&&(a=""+o),r.key!==void 0&&(a=""+r.key),r.ref!==void 0&&(v=r.ref);for(l in r)le.call(r,l)&&!ae.hasOwnProperty(l)&&(n[l]=r[l]);if(c&&c.defaultProps)for(l in r=c.defaultProps,r)n[l]===void 0&&(n[l]=r[l]);return{$$typeof:se,type:c,key:a,ref:v,props:n,_owner:ne.current}}O.Fragment=re;O.jsx=G;O.jsxs=G;F.exports=O;var e=F.exports,T={},U=Y;T.createRoot=U.createRoot,T.hydrateRoot=U.hydrateRoot;const ce=({selectedSection:c,onSectionChange:r})=>{const o=[{value:"sec0-2",label:"0-2 自分の道を見つける"},{value:"sec1-0",label:"1-0 多元性を見る"},{value:"sec2-0",label:"2-0 ITと民主主義 拡大する溝"},{value:"sec2-1",label:"2-1 玉山からの眺め"},{value:"sec2-2",label:"2-2 デジタル民主主義の日常"},{value:"sec3-0",label:"3-0 プルラリティ（多元性）とは？"},{value:"sec3-1",label:"3-1 ⿻世界に生きる"},{value:"sec3-2",label:"3-2 つながった社会"},{value:"sec3-3",label:"3-3 失われた道"},{value:"sec4-0",label:"4-0 権利、オペレーティングシステム、的自由"},{value:"sec4-1",label:"4-1 IDと人物性"},{value:"sec4-2",label:"4-2 団体と公衆"},{value:"sec4-3",label:"4-3 商取引と信頼"},{value:"sec4-4",label:"4-4 財産と契約"},{value:"sec4-5",label:"4-5 アクセス"},{value:"sec5-0",label:"5-0 協働テクノロジーと民主主義"},{value:"sec5-1",label:"5-1 ポスト表象コミュニケーション"},{value:"sec5-2",label:"5-2 没入型共有現実（ISR）"},{value:"sec5-3",label:"5-3 クリエイティブなコラボレーション"},{value:"sec5-4",label:"5-4 拡張熟議"},{value:"sec5-5",label:"5-5 適応型管理行政"},{value:"sec5-6",label:"5-6 ⿻投票"},{value:"sec5-7",label:"5-7 社会市場"},{value:"sec6-0",label:"6-0  から現実へ"},{value:"sec6-1",label:"6-1 職場"},{value:"sec6-2",label:"6-2 保健"},{value:"sec6-3",label:"6-3 メディア"},{value:"sec6-4",label:"6-4 環境"},{value:"sec6-5",label:"6-5 学習"},{value:"sec7-0",label:"7-0 政策"},{value:"sec7-1",label:"7-1 結論"}];return e.jsxs("div",{id:"toolbar",children:[e.jsx("h1",{children:"Plurality本の概念マップ"}),e.jsxs("div",{className:"section-selector",children:[e.jsx("label",{htmlFor:"section-select",children:"セクション選択:"}),e.jsx("select",{id:"section-select",value:c,onChange:l=>r(l.target.value),children:o.map(l=>e.jsx("option",{value:l.value,children:l.label},l.value))})]})]})},ie=({concept:c,edge:r,data:o,onConceptSelect:l,onEdgeSelect:n})=>{if(!c&&!r)return e.jsxs("div",{id:"details",children:[e.jsx("div",{className:"section-title",children:"概念または関係を選択してください"}),e.jsx("p",{style:{color:"var(--text-secondary)",fontSize:"13px"},children:"グラフ内のノードまたはエッジラベルをクリックすると、詳細情報と証拠が表示されます。"})]});if(r)try{return e.jsx("div",{id:"details",children:e.jsxs("div",{className:"concept-card",children:[e.jsxs("div",{className:"concept-header",children:[e.jsx("span",{className:"concept-tier tier-edge",children:"関係"}),e.jsx("h2",{className:"concept-title",children:r.relation_description||r.relation||r.type||"関係"})]}),o&&e.jsxs("div",{className:"related-concepts-section",children:[e.jsx("div",{className:"section-title",children:"関連概念"}),e.jsxs("div",{className:"related-concepts",children:[(()=>{var h;const s=typeof r.source=="string"?r.source:(h=r.source)==null?void 0:h.id,i=o.nodes.find(u=>u.id===s);return i?e.jsxs("div",{className:"related-concept clickable",onClick:()=>l&&l(i),children:[e.jsx("div",{className:"concept-name",children:i.label}),e.jsx("div",{className:"concept-def",children:i.definition})]}):null})(),(()=>{var h;const s=typeof r.target=="string"?r.target:(h=r.target)==null?void 0:h.id,i=o.nodes.find(u=>u.id===s);return i?e.jsxs("div",{className:"related-concept clickable",onClick:()=>l&&l(i),children:[e.jsx("div",{className:"concept-name",children:i.label}),e.jsx("div",{className:"concept-def",children:i.definition})]}):null})()]})]}),r.evidence&&r.evidence.length>0&&e.jsxs("div",{className:"evidence-section",children:[e.jsx("div",{className:"section-title",children:"根拠・引用"}),r.evidence.map((s,i)=>e.jsx("div",{className:"evidence-item",children:(s==null?void 0:s.text)||"証拠なし"},i))]})]})})}catch(s){return console.error("Error rendering edge details:",s),e.jsxs("div",{id:"details",children:[e.jsx("div",{className:"section-title",children:"エラー"}),e.jsx("p",{children:"関係情報の表示中にエラーが発生しました。"})]})}const a=c.aliases&&c.aliases.length>0?c.aliases:[],v=c.evidence&&c.evidence.length>0?c.evidence:[];return e.jsx("div",{id:"details",children:e.jsxs("div",{className:"concept-card",children:[e.jsxs("div",{className:"concept-header",children:[e.jsx("span",{className:"concept-tier tier-concept",children:"概念"}),e.jsx("h2",{className:"concept-title",children:c.label})]}),e.jsx("div",{className:"concept-definition",children:c.definition||"定義なし"}),a.length>0&&e.jsxs("div",{className:"aliases-section",children:[e.jsx("div",{className:"section-title",children:"別名・関連用語"}),e.jsx("div",{className:"aliases",children:a.map((s,i)=>e.jsx("span",{className:"alias-tag",children:s},i))})]}),v.length>0&&e.jsxs("div",{className:"evidence-section",children:[e.jsx("div",{className:"section-title",children:"根拠・引用"}),v.map((s,i)=>e.jsx("div",{className:"evidence-item",children:s.text},i))]}),o&&e.jsxs("div",{className:"relations-section",children:[e.jsx("div",{className:"section-title",children:"関係"}),e.jsx("div",{className:"relations",children:o.edges.filter(s=>{var u,R;const i=typeof s.source=="string"?s.source:(u=s.source)==null?void 0:u.id,h=typeof s.target=="string"?s.target:(R=s.target)==null?void 0:R.id;return i===c.id||h===c.id}).map((s,i)=>{var g,y;const h=typeof s.source=="string"?s.source:(g=s.source)==null?void 0:g.id,u=typeof s.target=="string"?s.target:(y=s.target)==null?void 0:y.id,_=h===c.id?u:h,S=o.nodes.find(I=>I.id===_),k=s.relation_description||(S?`${c.label}は${S.label}を${s.relation||s.type}。`:`${c.label}は${_}を${s.relation||s.type}。`);return e.jsx("div",{className:"relation-item clickable",onClick:()=>n&&n(s),children:e.jsx("div",{className:"relation-description",children:k})},i)})})]})]})})},oe=({data:c,onNodeSelect:r,onEdgeSelect:o,selectedConcept:l,selectedEdge:n})=>{const a=m.useRef(null),v=m.useRef(null),s=m.useRef(null),i=m.useRef(null),h=m.useRef(A),u=m.useRef(null),R=m.useMemo(()=>{const g=c.nodes.map(x=>({...x})),y=new Map(g.map(x=>[x.id,x])),I=c.edges.map(x=>({...x,source:y.get(x.source),target:y.get(x.target)}));return{nodes:g,links:I}},[c]);m.useEffect(()=>(u.current||(u.current=$("body").append("div").attr("class","tooltip").style("display","none")),()=>{var g;(g=u.current)==null||g.remove(),u.current=null}),[]),m.useEffect(()=>{if(!a.current||!v.current)return;const g=v.current,{width:y,height:I}=g.getBoundingClientRect(),x=$(a.current).attr("width",y).attr("height",I);let d=x.select("g.main-group");d.empty()&&(d=x.append("g").attr("class","main-group")),i.current||(i.current=K().scaleExtent([.3,3]).on("zoom",t=>{d.attr("transform",t.transform),h.current=t.transform}),x.call(i.current),(h.current.k!==1||h.current.x!==0||h.current.y!==0)&&x.call(i.current.transform,h.current));let N=d.select("g.links"),f=d.select("g.labels"),b=d.select("g.nodes");N.empty()&&(N=d.append("g").attr("class","links")),f.empty()&&(f=d.append("g").attr("class","labels")),b.empty()&&(b=d.append("g").attr("class","nodes"));const{nodes:j,links:w}=R,C=N.selectAll("line").data(w,t=>`${t.source.id}-${t.target.id}`);C.exit().remove();const M=C.enter().append("line").attr("class","link").merge(C),z=f.selectAll("text").data(w,t=>`${t.source.id}-${t.target.id}`);z.exit().remove();const Z=z.enter().append("text").attr("class","edge-label").style("cursor","pointer").on("click",(t,p)=>{t.stopPropagation(),o(p)}).merge(z).text(t=>t.relation||t.type||""),L=b.selectAll("g.node").data(j,t=>t.id);L.exit().remove();const P=L.enter().append("g").attr("class",t=>`node ${t.tier||"core"}`);P.append("circle").attr("r",t=>t.tier==="core"||!t.tier?12:t.tier==="supplementary"?10:8),P.append("text").attr("dx",16).attr("dy",4);const D=P.merge(L);if(D.select("text").text(t=>t.label),D.style("cursor","pointer").on("click",(t,p)=>{t.stopPropagation(),r(p)}).on("mouseover",(t,p)=>{u.current&&p.id!==(l==null?void 0:l.id)&&u.current.style("display","block").html(`<strong>${p.label}</strong><br/>${p.definition||""}<br/><em>${p.tier||"core"}</em>`)}).on("mousemove",t=>{u.current&&u.current.style("left",t.pageX+10+"px").style("top",t.pageY+10+"px")}).on("mouseout",()=>{u.current&&u.current.style("display","none")}),!s.current)s.current=W(j).force("link",X(w).id(t=>t.id).distance(100).strength(.5)).force("charge",H().strength(-300)).force("center",Q(y/2,I/2)).force("collision",V().radius(30));else{s.current.nodes(j);const t=s.current.force("link");t&&t.links(w),s.current.alpha(.3).restart()}s.current.on("tick",()=>{M.attr("x1",t=>t.source.x).attr("y1",t=>t.source.y).attr("x2",t=>t.target.x).attr("y2",t=>t.target.y),Z.attr("x",t=>(t.source.x+t.target.x)/2).attr("y",t=>(t.source.y+t.target.y)/2-5),D.attr("transform",t=>`translate(${t.x},${t.y})`)});const q=ee().on("start",(t,p)=>{var E;t.active||(E=s.current)==null||E.alphaTarget(.3).restart(),p.fx=p.x,p.fy=p.y}).on("drag",(t,p)=>{p.fx=t.x,p.fy=t.y}).on("end",(t,p)=>{var E;t.active||(E=s.current)==null||E.alphaTarget(0),p.fx=null,p.fy=null});return D.call(q),()=>{var t;(t=s.current)==null||t.stop()}},[R,r,o]),m.useEffect(()=>{if(!a.current)return;const g=$(a.current),y=g.selectAll("g.node"),I=g.selectAll(".link"),x=g.selectAll(".edge-label");if(y.classed("highlighted",!1).classed("dimmed",!1).classed("selected",!1),I.classed("highlighted",!1).classed("dimmed",!1),x.classed("highlighted",!1).classed("dimmed",!1),l)y.classed("selected",d=>d.id===l.id).classed("highlighted",d=>d.id===l.id).classed("dimmed",d=>d.id!==l.id);else if(n){const d=typeof n.source=="string"?n.source:n.source.id,N=typeof n.target=="string"?n.target:n.target.id;y.classed("highlighted",f=>f.id===d||f.id===N).classed("dimmed",f=>f.id!==d&&f.id!==N),I.classed("highlighted",f=>{const b=f.source.id,j=f.target.id;return b===d&&j===N||b===N&&j===d}).classed("dimmed",f=>{const b=f.source.id,j=f.target.id;return!(b===d&&j===N||b===N&&j===d)}),x.classed("highlighted",f=>{const b=f.source.id,j=f.target.id;return b===d&&j===N||b===N&&j===d}).classed("dimmed",f=>{const b=f.source.id,j=f.target.id;return!(b===d&&j===N||b===N&&j===d)})}},[l,n]);const _=m.useCallback(()=>{a.current&&i.current&&$(a.current).transition().call(i.current.scaleBy,1.5)},[]),S=m.useCallback(()=>{a.current&&i.current&&$(a.current).transition().call(i.current.scaleBy,.67)},[]),k=m.useCallback(()=>{a.current&&i.current&&$(a.current).transition().call(i.current.transform,A)},[]);return e.jsxs("div",{ref:v,id:"graph-container",children:[e.jsx("svg",{ref:a,id:"graph"}),e.jsxs("div",{className:"zoom-controls",children:[e.jsx("div",{className:"zoom-btn",onClick:_,children:"+"}),e.jsx("div",{className:"zoom-btn",onClick:S,children:"−"}),e.jsx("div",{className:"zoom-btn",style:{fontSize:"12px"},onClick:k,children:"⌂"})]})]})},de={nodes:[{id:"loading",label:"データ読み込み中...",tier:"core",definition:"グラフデータが読み込まれるまでお待ちください",aliases:[],evidence:[]}],edges:[]},B=async c=>{const r=c?`graph_${c}.json`:"graph_sec1-0.json";try{const o=await fetch(`./${r}`);if(o.ok){const l=await o.json();return console.log(`Loaded ${r} successfully`),l}}catch{console.warn(`No ${r} found`)}if(c&&c!=="sec1-0")try{const o=await fetch("./graph_sec1-0.json");if(o.ok){const l=await o.json();return console.log("Loaded fallback graph_sec1-0.json successfully"),l}}catch{console.warn("No graph_sec1-0.json found either")}return console.log("Using fallback data - no graph files found"),de};function ue(){const[c,r]=m.useState({nodes:[],edges:[]}),[o,l]=m.useState(!0),[n,a]=m.useState(null),[v,s]=m.useState(null),[i,h]=m.useState("sec1-0"),u=S=>{a(S),s(null)},R=S=>{s(S),a(null)},_=async S=>{l(!0),a(null),s(null),h(S);try{const k=await B(S);r(k)}catch(k){console.warn("Error loading section data:",k)}finally{l(!1)}};return m.useEffect(()=>{(async()=>{try{const k=await B("sec1-0");if(k.nodes.length>0&&(r(k),!n&&!v)){const g=k.nodes.find(y=>y.tier==="core"||!y.tier);g&&a(g)}}catch(k){console.warn("Using sample data due to error:",k)}finally{l(!1)}})()},[]),o?e.jsx("div",{id:"app",style:{alignItems:"center",justifyContent:"center"},children:e.jsx("div",{children:"Loading concept map..."})}):e.jsxs("div",{id:"app",children:[e.jsxs("div",{id:"sidebar",children:[e.jsx(ce,{selectedSection:i,onSectionChange:_}),e.jsx(ie,{concept:n,edge:v,data:c,onConceptSelect:u,onEdgeSelect:R})]}),e.jsx(oe,{data:c,onNodeSelect:u,onEdgeSelect:R,selectedConcept:n,selectedEdge:v})]})}T.createRoot(document.getElementById("root")).render(e.jsx(J.StrictMode,{children:e.jsx(ue,{})}));
