import{r as u,a as W,R as X}from"./react-nf7bT_Uh.js";import{i as q,s as b,a as Z,l as ee,m as te,c as se,b as re,d as ne,z as ie}from"./d3-BqCrgHhh.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))o(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const g of i.addedNodes)g.tagName==="LINK"&&g.rel==="modulepreload"&&o(g)}).observe(document,{childList:!0,subtree:!0});function f(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function o(n){if(n.ep)return;n.ep=!0;const i=f(n);fetch(n.href,i)}})();var F={exports:{}},O={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ce=u,ae=Symbol.for("react.element"),le=Symbol.for("react.fragment"),oe=Object.prototype.hasOwnProperty,de=ce.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,ue={key:!0,ref:!0,__self:!0,__source:!0};function H(c,s,f){var o,n={},i=null,g=null;f!==void 0&&(i=""+f),s.key!==void 0&&(i=""+s.key),s.ref!==void 0&&(g=s.ref);for(o in s)oe.call(s,o)&&!ue.hasOwnProperty(o)&&(n[o]=s[o]);if(c&&c.defaultProps)for(o in s=c.defaultProps,s)n[o]===void 0&&(n[o]=s[o]);return{$$typeof:ae,type:c,key:i,ref:g,props:n,_owner:de.current}}O.Fragment=le;O.jsx=H;O.jsxs=H;F.exports=O;var e=F.exports,T={},M=W;T.createRoot=M.createRoot,T.hydrateRoot=M.hydrateRoot;const fe=()=>e.jsx("div",{id:"toolbar",children:e.jsx("h1",{children:"Plurality本の概念マップ"})}),pe=({concept:c,edge:s,data:f,onConceptSelect:o,onEdgeSelect:n})=>{if(!c&&!s)return e.jsxs("div",{id:"details",children:[e.jsx("div",{className:"section-title",children:"概念または関係を選択してください"}),e.jsx("p",{style:{color:"var(--text-secondary)",fontSize:"13px"},children:"グラフ内のノードまたはエッジラベルをクリックすると、詳細情報と証拠が表示されます。"})]});if(s)try{return e.jsx("div",{id:"details",children:e.jsxs("div",{className:"concept-card",children:[e.jsxs("div",{className:"concept-header",children:[e.jsx("span",{className:"concept-tier tier-edge",children:"関係"}),e.jsx("h2",{className:"concept-title",children:s.relation_description||s.relation||s.type||"関係"})]}),f&&e.jsxs("div",{className:"related-concepts-section",children:[e.jsx("div",{className:"section-title",children:"関連概念"}),e.jsxs("div",{className:"related-concepts",children:[(()=>{var x;const r=typeof s.source=="string"?s.source:(x=s.source)==null?void 0:x.id,l=f.nodes.find(m=>m.id===r);return l?e.jsxs("div",{className:"related-concept clickable",onClick:()=>o&&o(l),children:[e.jsx("div",{className:"concept-name",children:l.label}),e.jsx("div",{className:"concept-def",children:l.definition})]}):null})(),(()=>{var x;const r=typeof s.target=="string"?s.target:(x=s.target)==null?void 0:x.id,l=f.nodes.find(m=>m.id===r);return l?e.jsxs("div",{className:"related-concept clickable",onClick:()=>o&&o(l),children:[e.jsx("div",{className:"concept-name",children:l.label}),e.jsx("div",{className:"concept-def",children:l.definition})]}):null})()]})]}),s.evidence&&s.evidence.length>0&&e.jsxs("div",{className:"evidence-section",children:[e.jsx("div",{className:"section-title",children:"根拠・引用"}),s.evidence.map((r,l)=>e.jsx("div",{className:"evidence-item",children:(r==null?void 0:r.text)||"証拠なし"},l))]})]})})}catch(r){return console.error("Error rendering edge details:",r),e.jsxs("div",{id:"details",children:[e.jsx("div",{className:"section-title",children:"エラー"}),e.jsx("p",{children:"関係情報の表示中にエラーが発生しました。"})]})}const i=c.aliases&&c.aliases.length>0?c.aliases:[],g=c.evidence&&c.evidence.length>0?c.evidence:[];return e.jsx("div",{id:"details",children:e.jsxs("div",{className:"concept-card",children:[e.jsxs("div",{className:"concept-header",children:[e.jsx("span",{className:"concept-tier tier-concept",children:"概念"}),e.jsx("h2",{className:"concept-title",children:c.label})]}),e.jsx("div",{className:"concept-definition",children:c.definition||"定義なし"}),i.length>0&&e.jsxs("div",{className:"aliases-section",children:[e.jsx("div",{className:"section-title",children:"別名・関連用語"}),e.jsx("div",{className:"aliases",children:i.map((r,l)=>e.jsx("span",{className:"alias-tag",children:r},l))})]}),g.length>0&&e.jsxs("div",{className:"evidence-section",children:[e.jsx("div",{className:"section-title",children:"根拠・引用"}),g.map((r,l)=>e.jsx("div",{className:"evidence-item",children:r.text},l))]}),f&&e.jsxs("div",{className:"relations-section",children:[e.jsx("div",{className:"section-title",children:"関係"}),e.jsx("div",{className:"relations",children:f.edges.filter(r=>{var m,y;const l=typeof r.source=="string"?r.source:(m=r.source)==null?void 0:m.id,x=typeof r.target=="string"?r.target:(y=r.target)==null?void 0:y.id;return l===c.id||x===c.id}).map((r,l)=>{var C,I;const x=typeof r.source=="string"?r.source:(C=r.source)==null?void 0:C.id,m=typeof r.target=="string"?r.target:(I=r.target)==null?void 0:I.id,R=x===c.id?m:x,S=f.nodes.find(D=>D.id===R),$=r.relation_description||(S?`${c.label}は${S.label}を${r.relation||r.type}。`:`${c.label}は${R}を${r.relation||r.type}。`);return e.jsx("div",{className:"relation-item clickable",onClick:()=>n&&n(r),children:e.jsx("div",{className:"relation-description",children:$})},l)})})]})]})})},me=({data:c,onNodeSelect:s,onEdgeSelect:f,selectedConcept:o,selectedEdge:n})=>{const i=u.useRef(null),g=u.useRef(null),[r,l]=u.useState(!1),x=u.useRef(null),m=u.useRef(!1),y=u.useRef(null),R=u.useRef(q),S=u.useRef(s),$=u.useRef(f);u.useEffect(()=>{S.current=s,$.current=f},[s,f]);const C=u.useCallback(h=>{S.current(h)},[]),I=u.useCallback(h=>{$.current(h)},[]),D=u.useMemo(()=>{const h=c.nodes.map(j=>({...j})),N=new Map(h.map(j=>[j.id,j])),_=c.edges.map(j=>({...j,source:N.get(j.source),target:N.get(j.target)}));return{nodes:h,links:_,id2node:N}},[c]),w=u.useCallback(()=>{if(!i.current)return;const h=b(i.current),N=h.selectAll(".node"),_=h.selectAll(".link"),j=h.selectAll(".edge-label");if(N.classed("highlighted",!1).classed("dimmed",!1),_.classed("highlighted",!1).classed("dimmed",!1),j.classed("highlighted",!1).classed("dimmed",!1),o)N.classed("highlighted",p=>p.id===o.id).classed("dimmed",p=>p.id!==o.id);else if(n){const p=typeof n.source=="string"?n.source:n.source.id,v=typeof n.target=="string"?n.target:n.target.id;N.classed("highlighted",a=>a.id===p||a.id===v).classed("dimmed",a=>a.id!==p&&a.id!==v),_.classed("highlighted",a=>a.source.id===p&&a.target.id===v||a.source.id===v&&a.target.id===p).classed("dimmed",a=>!(a.source.id===p&&a.target.id===v||a.source.id===v&&a.target.id===p)),j.classed("highlighted",a=>a.source.id===p&&a.target.id===v||a.source.id===v&&a.target.id===p).classed("dimmed",a=>!(a.source.id===p&&a.target.id===v||a.source.id===v&&a.target.id===p))}},[o,n,c]);return u.useEffect(()=>{var G;if(!i.current||!g.current)return;const N=(G=b(g.current).node())==null?void 0:G.getBoundingClientRect();if(!N)return;const _=N.width,j=N.height;b(i.current).selectAll("*").remove();const p=b(i.current).attr("width",_).attr("height",j),v=p.append("g"),a=v.append("g"),V=v.append("g"),Y=v.append("g"),{nodes:z,links:L}=D,J=a.selectAll("line").data(L).enter().append("line").attr("class","link"),K=V.selectAll("text").data(L).enter().append("text").attr("class","edge-label").text(t=>t.relation||t.type).style("cursor","pointer").on("click",function(t,d){t.stopPropagation(),m.current=!0,l(!0),I(d)}),k=Y.selectAll("g").data(z).enter().append("g").attr("class",t=>`node ${t.tier}`);k.append("circle").attr("r",t=>t.tier==="core"?12:t.tier==="supplementary"?10:8),k.append("text").attr("dx",16).attr("dy",4).text(t=>t.label);const E=b("body").append("div").attr("class","tooltip").style("display","none"),B=function(t,d){k.classed("selected",!1),x.current=d,b(this).classed("selected",!0),C(d),t&&(m.current=!0,l(!0))};k.on("click",B).on("mouseover",(t,d)=>{x.current!==d&&E.style("display","block").html(`<strong>${d.label}</strong><br/>${d.definition||""}<br/><em>${d.tier}</em>`)}).on("mousemove",t=>{E.style("left",t.pageX+10+"px").style("top",t.pageY+10+"px")}).on("mouseout",()=>E.style("display","none"));const A=Z(z).force("link",ee(L).id(t=>t.id).distance(100).strength(.5)).force("charge",te().strength(-300)).force("center",se(_/2,j/2)).force("collision",re().radius(30));A.on("tick",()=>{J.attr("x1",t=>t.source.x).attr("y1",t=>t.source.y).attr("x2",t=>t.target.x).attr("y2",t=>t.target.y),K.attr("x",t=>(t.source.x+t.target.x)/2).attr("y",t=>(t.source.y+t.target.y)/2-5),k.attr("transform",t=>`translate(${t.x},${t.y})`)}),k.call(ne().on("start",(t,d)=>{t.active||A.alphaTarget(.3).restart(),d.fx=d.x,d.fy=d.y}).on("drag",(t,d)=>{d.fx=t.x,d.fy=t.y}).on("end",(t,d)=>{t.active||A.alphaTarget(0),d.fx=null,d.fy=null}));const P=ie().scaleExtent([.3,3]).on("zoom",t=>{v.attr("transform",t.transform),R.current=t.transform});y.current=P,p.call(P),R.current&&!R.current.toString().includes("1,0,0,1,0,0")&&p.call(P.transform,R.current);const U=z.find(t=>t.tier==="core");return U&&!m.current&&setTimeout(()=>{const t=k.filter(d=>d===U);t.empty()||B.call(t.node(),null,U)},100),w(),()=>{E.remove()}},[D,w]),u.useEffect(()=>{w()},[w]),e.jsxs("div",{ref:g,id:"graph-container",children:[e.jsx("svg",{ref:i,id:"graph"}),e.jsxs("div",{className:"zoom-controls",children:[e.jsx("div",{className:"zoom-btn",onClick:()=>{const h=b(i.current);y.current&&h.transition().call(y.current.scaleBy,1.5)},children:"+"}),e.jsx("div",{className:"zoom-btn",onClick:()=>{const h=b(i.current);y.current&&h.transition().call(y.current.scaleBy,.67)},children:"−"}),e.jsx("div",{className:"zoom-btn",style:{fontSize:"12px"},onClick:()=>{const h=b(i.current);y.current&&h.transition().call(y.current.transform,q)},children:"⌂"})]})]})},Q={nodes:[{id:"plurality",label:"プラリティ",definition:"多様性と協力を両立させる社会技術の概念",tier:"core",aliases:["多様性協力","Plurality"],evidence:[{text:"プラリティは、多様性と協力という一見矛盾する要素を技術によって両立させることを目指す概念です。",section:"第1章"}]},{id:"digital_democracy",label:"デジタル民主主義",definition:"デジタル技術を活用した民主的意思決定の仕組み",tier:"supplementary",aliases:["電子民主主義","Digital Democracy"],evidence:[{text:"デジタル民主主義は、インターネットやAIを活用して、より多くの人々が政治プロセスに参加できる仕組みを作ります。",section:"第2章"}]},{id:"quadratic_voting",label:"二次投票",definition:"投票コストが票数の二乗に比例する投票制度",tier:"advanced",aliases:["QV","Quadratic Voting"],evidence:[{text:"二次投票では、より多くの票を投じるほどコストが二次関数的に増加し、強い選好を持つ意見により大きな重みを与えます。",section:"第3章"}]}],edges:[{source:"digital_democracy",target:"plurality",type:"part_of",confidence:.9,evidence:[{text:"デジタル民主主義は、プラリティの実現手段の一つとして重要な役割を果たします。"}]},{source:"quadratic_voting",target:"digital_democracy",type:"example_of",confidence:.8,evidence:[{text:"二次投票は、デジタル民主主義の具体的な実装例として注目されています。"}]}]},he=async c=>{try{const s=await fetch("./graph.json");if(s.ok){const f=await s.json();return console.log("Loaded graph.json successfully"),f}}catch{console.warn("No graph.json found, using sample data")}return console.log("Using sample data"),Q};function ge(){const[c,s]=u.useState(Q),[f,o]=u.useState(!0),[n,i]=u.useState(null),[g,r]=u.useState(null),l=m=>{i(m),r(null)},x=m=>{r(m),i(null)};return u.useEffect(()=>{(async()=>{try{const y=await he();y.nodes.length>0&&s(y)}catch(y){console.warn("Using sample data due to error:",y)}finally{o(!1)}})()},[]),f?e.jsx("div",{id:"app",style:{alignItems:"center",justifyContent:"center"},children:e.jsx("div",{children:"Loading concept map..."})}):e.jsxs("div",{id:"app",children:[e.jsxs("div",{id:"sidebar",children:[e.jsx(fe,{}),e.jsx(pe,{concept:n,edge:g,data:c,onConceptSelect:l,onEdgeSelect:x})]}),e.jsx(me,{data:c,onNodeSelect:l,onEdgeSelect:x,selectedConcept:n,selectedEdge:g})]})}T.createRoot(document.getElementById("root")).render(e.jsx(X.StrictMode,{children:e.jsx(ge,{})}));
